# Структура базы данных

<img src="distributed-calculator database design.jpg" alt="Convert table to XML" width="706" border-effect="line"/>

[Структура базы данных](https://miro.com/app/board/uXjVNrhKecg=/?share_link_id=685161824778)

## Таблица expressions
Хранит выражения, введённые пользователем, информацию о них, статусы и их результат:
* **id** - идентификатор выражения
* **expression** - строка, представляющая собой корректное математическое выражение
* **result** - результат выражения (хранит 0 по умолчанию)
* **status** - [статус](Statuses.md) выражения
* **created_at** - дата и время создания записи в таблице
* **finished_at** - дата и время окончания расчёта выражения (по умолчанию хранит дату и время создания записи)
* **idempotency_key** - ключ идемпотентности для каждого выражения

## Таблица expressions_tree
Хранит структуру двоичного дерева, построенного на основе переданного выражения
* **id** - идентификатор узла дерева
* **parent_id** - идентификатор родительского узла дерева (```null```, если узел является корнем)
* **expression_id** - идентификатор исходного выражения из таблицы expressions
* **type** - 0 для левого узла и 1 для правого
* **operation_type** - тип оператора (```null```, если узел является числом)
* **status** - [статус](Statuses.md) задачи
* **result** - результат выполнения арифметических операций для всех потомков текущего узла
* **worker_id** - идентификатор агента, выполняющего задачу (```null```, если задача не выполняется)

## Таблица workers
Хранит информацию о жоступных агентах для выполнения задачи
* **id** - идентификатор агента
* **url** - ссылка для обращения к api агента
* **executors** - максимальное количество одновременно работающих горутин
* **last_modified** - дата и время получения последнего ping-запроса или регистрации агента

## Таблица operators
* **operator_type** - тип арифметической операции
* **duration_ms** - время выполнения операции в миллисекундах