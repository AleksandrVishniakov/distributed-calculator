# Документация API

## Работа с выражениями
### Создание нового выражения
```HTTP
POST /api/expressions
```
Проверяет ключ идемпотентности и создаёт новую запись с выраженим в базе данных и возвращает её идентификатор
#### Тело запроса
```json
{
  "expression": "2+2*2",
  "idempotencyKey": "UUID_KEY"
}
```
#### Тело ответа
```json
{
  "id": 1
}
```

### Получение информации и о выражении
```HTTP
GET /api//expression/:id
```
Получает информацию о выражении из базы данных, возвращает его [статус](Statuses.md) и результат
#### Тело ответа
```json
{
  "id": 1,
  "expression": "2+2*2",
  "createdAt": "2024-02-16T19:33:27.898659Z",
  "finishedAt": "2024-02-16T19:33:27.898659Z",
  "status": 3,
  "result": 6
}
```

### Получение списка всех выражений
```HTTP
GET /api//expressions
```
Возвращает информацию о всех выражениях, записанных в базе данных
#### Тело ответа
```json
[
  {
    "id": 1,
    "expression": "2+2*2",
    "createdAt": "2024-02-16T19:33:27.898659Z",
    "finishedAt": "2024-02-16T19:33:27.898659Z",
    "status": 3,
    "result": 6
  }
]
```

## Работа с операторами
### Сохранения нового времени выполнения для каждого оператора
```HTTP
POST /api//operators
```
Сохраняет новое время выполнения для каждого оператора
#### Тело запроса
```json
[
  {
    "operationType": 0,
    "durationMS": 100
  },
  {
    "operationType": 1,
    "durationMS": 200
  },
  {
    "operationType": 2,
    "durationMS": 300
  },
  {
    "operationType": 3,
    "durationMS": 400
  }
]
```

### Получение информации обо всех операторах
```HTTP
GET /api//operators
```
Возвращает тип каждого оператора и время его выполнения
#### Тело ответа
```json
[
  {
    "operationType": 0,
    "durationMS": 100
  },
  {
    "operationType": 1,
    "durationMS": 200
  },
  {
    "operationType": 2,
    "durationMS": 300
  },
  {
    "operationType": 3,
    "durationMS": 400
  }
]
```

## Работа с агентами
### Добавление нового агента
```HTTP
POST /api//worker
```
Добавляет информацию о новом агенте в базу данных
#### Тело запроса
```json
{
    "id": 1,
    "url": "http://localhost:8001",
    "executors": 10
}
```

### Получение информации обо всех огентах
```HTTP
GET /api//workers
```
Возвращает информацию обо всех доступных агентах из базы данных
#### Тело ответа
```json
[
    {
        "id": 1,
        "url": "http://daemon1:8001",
        "executors": 1,
        "lastModified": "2024-02-18T15:43:22.456728Z"
    },
    {
        "id": 2,
        "url": "http://daemon2:8002",
        "executors": 5,
        "lastModified": "2024-02-18T15:43:22.586835Z"
    }
]
```

### Получение задач, выполняемых агентом
```HTTP
GET /api//worker/:id/tasks
```
Возвращает список задач, выполняемых агентом
#### Тело ответа
```json
[
    {
        "leftResult": 2,
        "operationType": 0,
        "rightResult": 6,
        "status": 2
    },
    {
        "leftResult": 2,
        "operationType": 2,
        "rightResult": 3,
        "status": 2
    },
    {
        "leftResult": 2,
        "operationType": 0,
        "rightResult": 6,
        "status": 2
    }
]
```

## Работа с задачами
Задача - простое арифметическое выражение из одной операции, которое может посчитать агент. Пути из этой группы используются только внутри приложения агентами
### Начало работы над задачей
```HTTP
POST /api//task/:id/status
```
Ставит статус для задачи *"выполняется"*. Вызывается, когда агент начинает работу над задачей

### Получение результата задачи
```HTTP
POST /api//task/:id/result
```
Записывает результат и статус для задачи
#### Тело запроса
```json
{
  "result": 10
}
```

## Ошибки API
Иногда в работе сервиса могут возникать ошибки, имеющие следующую структуру:
```json
{
    "code": 400,
    "message": "expression: invalid brackets placement",
    "timestamp": "2024-02-18T15:56:40.023882214Z"
}
```